{"name":"Dashcam","tagline":"Raspberry Pi/BeagleBone Black Dashcam","body":"## About\r\nC/Python dashcam built with Gstreamer/Raspivid for Raspberry Pi/BeagleBone Black. Currently in development. Supports webcams with hardware H264 or MJPEG encoders and the RaspberryPi camera module. Below are test videos of boot times and recording quality compared to a FineVu CR-500HD. Currently only records video, the audio in the test video is from the CR-500HD. The distortion at the start of both videos wasn't in the original videos but happened after cutting the clips in an editor. There is also some distortion in the video from the Raspberry Pi this is caused by usb issues which limit the camera from working above 720p. The BeagleBone Black is able to run at 1080p without any issues. The RaspberryPi camera module will run at 1080p without any issues.\r\n\r\n### Rasperry Pi + Logitech C920 and FineVu CR-500HD\r\nInsert Embedded YouTube Video\r\n<iframe width=\"600\" height=\"338\" src=\"//www.youtube-nocookie.com/embed/uIr5TrsctiQ?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\r\n\r\n### BeagleBone Black + Logitech C920 and FineVu CR-500HD\r\nInsert Embedded YouTube Video\r\n<iframe width=\"600\" height=\"338\" src=\"//www.youtube-nocookie.com/embed/4CfveH7DjoU?rel=0\" frameborder=\"0\" allowfullscreen></iframe>\r\n\r\n#### Boot Times\r\nRaspberry Pi: 19s<br/>\r\nFineVu CR-500HD: 26s<br/>\r\nBeagleBone Black: 28s\r\n#### Storage\r\nRaspberry Pi (16gb/720p/30fps/Logitech C920): 9 hrs 45 mins<br/>\r\nBeagleBone Black (16gb/1080p/30fps/Logitech C920): 9 hrs 30 mins<br/>\r\nFineVu CR-500HD (16gb/1080p/30fps): 3 hrs 30 mins\r\n\r\n## Webcams\r\nThe best webcam to use is the Logitech C920 or any webcam with an H264 encoder supported by v4l2. Other webcams with MJPEG will work but MJPEG has very little compression so only about an hour of video will fit on a 16gb card. Run `v4l2-ctl --list-formats-ext` to check for supported formats and look for H264 or MJPG pixel formats.\r\n\r\n## Required Parts\r\nTo use all the features you will need the parts below. The LED is used to display the status of the recording. The real time clock module is used to put the date and time in the filename of output videos.\r\n\r\n* Raspberry Pi or BeagleBone Black\r\n* Logitech C920 or RaspberryPi camera module\r\n* Powered USB Hub\r\n* [Optional] LED + resistor + wire + soldering iron\r\n* [Optional] Real time clock module\r\n\r\n## Raspberry Pi Arch Linux Install\r\nConnect the sd card and download Arch Linux ARM image. Unzip it and write it to the sd card. Full directions for Windows and Linx are on [archlinuxarm.org](http://archlinuxarm.org/platforms/armv6/raspberry-pi).\r\n\r\n```\r\n# The link below may be out of date, goto the link above to find latest image\r\n$ wget http://archlinuxarm.org/os/rpi/archlinux-hf-2013-06-15.img.zip\r\n$ unzip archlinux-hf-2013-06-15.img.zip\r\n$ dd bs=1M if=archlinux-hf-2013-06-15.img of=/dev/sdX\r\n# Use gparted to extend root partition\r\n```\r\n\r\n## BeagleBone Black Arch Linux Install\r\nIf you want to always boot from the sd card first connect BeagleBone Black with usb and rename the MLO file in the boot partition. If you don't rename the file you will need to hold the boot selection button when booting. Then fdisk the sd card to create partitions and extract the tarball's. Full directions for Linux are on [archlinuxarm.org](http://archlinuxarm.org/platforms/armv7/beaglebone-black).\r\n\r\n```\r\n# List all disk divices, look for sd card\r\n$ fdisk -l\r\n# Fdisk the sd card\r\n$ fdisk /dev/sdX\r\n# Type o to clear partitions\r\n# Type n, enter, enter, enter, +64M\r\n# Type t then e\r\n# Type a\r\n# Type n, enter, enter, enter, enter\r\n# Type w to write partitions\r\n$ mkfs.vfat -F 16 /dev/sdX1\r\n$ mkfs.ext4 /dev/sdX2\r\n$ wget http://archlinuxarm.org/os/omap/BeagleBone-bootloader.tar.gz\r\n$ mkdir boot\r\n$ mount /dev/sdX1 boot\r\n# Tar command will print change ownership errors\r\n$ tar -xf BeagleBone-bootloader.tar.gz -C boot\r\n$ umount boot\r\n$ wget http://archlinuxarm.org/os/ArchLinuxARM-am33x-latest.tar.gz\r\n$ mkdir root\r\n$ mount /dev/sdX2 root\r\n$ tar -xf ArchLinuxARM-am33x-latest.tar.gz -C root\r\n$ umount root\r\n```\r\n\r\n## Install\r\nConnect sd card and network cable then power on the device.\r\n\r\n```\r\n# Scan local network to find dhcp address of device\r\n$ nmap -sn 10.0.0.0/24\r\n# SSH to device\r\n$ ssh root@10.0.0.150\r\n# Update packages\r\n$ pacman -Syu\r\n# Install dev packages and yaourt to sync from AUR\r\n$ pacman -S base-devel yaourt\r\n# If you have a speaker install pygame to play dashcam starting sound\r\n$ pacman -S python2-pygame\r\n```\r\n\r\nFor Raspberry Pi LED support install RPi.GPIO Python library.\r\n\r\n```\r\n$ yaourt -S python2-raspberry-gpio\r\n# Press n, y, y and enter\r\n```\r\n\r\nFor BeagleBone Black LED support install BBIO.GPIO python library.\r\n\r\n```\r\n$ yaourt -S python2-bbio\r\n# Press n, y, y and enter\r\n```\r\n\r\nIf you're using the RaspberryPi camera module it must be enable by adding the two lines below to boot config.\r\n\r\n```\r\n$ nano /boot/config.txt\r\nstart_file=start_x.elf\r\nfixup_file=fixup_x.dat\r\n```\r\n\r\nIf you're using the Logitech C920 install the patched gst-plugins-good to fix support for C920.\r\n\r\n```\r\n$ yaourt -S gst-plugins-good-c920\r\n# Press n, y, y and enter\r\n```\r\n\r\n## Dashcam Install\r\nInstall dashcam from AUR. Then create directory to store dashcam videos. To auto start on boot enable the systemd service. When the application starts two beeps will be played, when recording starts/stops the LED will turn on/off.\r\n\r\n```\r\n$ yaourt -S dashcam\r\n# Press n, y, y and enter\r\n$ mkdir -P /media\r\n$ systemctl enable dashcamd.service\r\n```\r\n\r\n## Dashcam Configuration\r\nEdit `/etc/dashcam.conf` to change dashcam settings. Below is an example configuration. After editing config run `systemctl start dashcamd.service` to start service or `dashcam` to test.\r\n\r\n```\r\n#!/usr/bin/python2\r\n# V4l2 input device or 'raspivid' for raspberry pi camera module\r\ninput_device = '/dev/video0'\r\n# Webcam input media type. For H264 webcams use 'video/x-h264' for MJPEG\r\n# webcams use 'image/jpeg'. Check 'v4l2-ctl --list-formats-ext' to find\r\n# correct media type. Option not aviable with RPi camera module.\r\ninput_media_type = 'video/x-h264'\r\n# Delay in microseconds between file segments. Sometimes the webcam will give\r\n# device is busy error if this value is too low. 10000 = 0.01 seconds. Option\r\n# not aviable with RPi camera module.\r\ninput_device_delay = 10000\r\n# Webcam width. Check 'v4l2-ctl --list-formats-ext' to get valid values.\r\ninput_width = 1920\r\n# Webcam height. Check 'v4l2-ctl --list-formats-ext' to get valid values.\r\ninput_height = 1080\r\n# Webcam frame rate. Check 'v4l2-ctl --list-formats-ext' to get valid values.\r\ninput_frame_rate = 30\r\n# Output muxer. Can be 'avimux' for avi files or 'matroskamux' for mkv files.\r\n# If input_media_type is 'video/x-h264' then 'mp4mux' can also be used for\r\n# mp4 files. Option not aviable with RPi camera module.\r\noutput_muxer = 'avimux'\r\n# Length in seconds of each video segment. A new video file will be created\r\n# at this interval.\r\noutput_segment_length = 300\r\n# Output path for video files. If a real time clock is installed a strftime\r\n# formatted file name can be used '%Y_%m_%d_%H_%M_%S' will put the full date\r\n# and time into the filename. When using strftime the filename must be done\r\n# so that when the files are alphabetized the oldest file will be the first\r\n# in the list, this is used to auto delete old videos when space is low.\r\n# Using '%i' will add a four digit incremented number to the filename, after\r\n# reaching 9999 it will restart back at 0. When using '%i' it must be at the\r\n# end of the filename before the file extension and cannot be adjacent to any\r\n# %X strftime formatters. File extension must be set to the output_muxer type\r\n# or if using RPi camera module set to '.h264'.\r\noutput_path = '/media/dashcam_%i.avi'\r\n# This file is used by the gstreamer process to communicate the state of the\r\n# stream to the python process which will turn the LED on and off. Option not\r\n# aviable with RPi camera module.\r\nstream_state_path = '/var/run/dashcam_stream_state'\r\n# Decimal minimum percent of free space before the oldest videos are\r\n# automatically removed to make space for new videos. The space is checked\r\n# every second so even with a long file segment no more than 5% or 0.05\r\n# is necessary. Set to None without quotes to disable auto deletion.\r\nmin_free_space = 0.05\r\n# Decimal percent volume level of dashcam starting beep. Python module\r\n# pygame must be installed for sound to work. Set to None without quotes to\r\n# disable sound.\r\nvolume_level = 0.75\r\n# GPIO pin that the LED is connected to. If you connected the LED to the pins\r\n# shown in the readme the pin for the Raspberry Pi will be 13 and 'P8_10'\r\n# for the BeagleBone Black. GPIO package must be installed for LED to work.\r\n# Set to None without quotes to disable LED.\r\nlight_gpio_pin = 13\r\n# Location of log file. Set to None without quotes to print output to console.\r\nlog_file_path = '/var/log/dashcam.log'\r\n# Enable debug output.\r\ndebug = True\r\n# Optional v4l2/raspivid parameters to set. The autofocus on some webcams may\r\n# not focus properly, 0 is usually the best manual focus for dashcam.\r\n# Brightness and contrast can also be adjusted, run 'v4l2-ctl --list-ctrls' or\r\n# 'raspivid --help' to get a full list of available controls.\r\n# v4l2 example\r\n# output_params = {\r\n#     'focus_auto': 0,\r\n#     'focus_absolute': 0,\r\n#     'brightness': 128,\r\n#     'contrast': 128,\r\n#     'saturation': 128,\r\n#     'sharpness': 128,\r\n# }\r\n# raspivid example\r\n# output_params = {\r\n#     'sharpness': 50,\r\n#     'brightness': 75,\r\n#     'saturation': 75,\r\n#     'exposure': 'night',\r\n#     'awb': 'sun',\r\n#     'rotation': 180,\r\n#     'hflip': None,\r\n#     'vflip': None,\r\n#     'vstab': None,\r\n# }\r\n```\r\n\r\n## LED Setup\r\nYou will need an LED, resistor and wire. The LED, resistor and jumper wire with female connections are sold at Radio Shack. If you need a long wire for LED you can also cut apart a cat 5 ethernet cable and pull a wire pair out. The power coming from the BeagleBone Black or Raspberry Pi will be 3.3V, to get the minimum resistor use (3.3V - {LED voltage}) / ({LED current of LED} * 0.001) = resistor ohms. Example (3.3V - 2.6V) / (28mA * 0.001) = 25ohm. The higher the resistor above the minimum the dimmer the LED will be. Below is a picture of the brightness of some resistors.\r\n\r\n![Resistors](http://zachhuff386.github.io/dashcam-dev/images/resistors.jpg)\r\n\r\n![Step 1](http://zachhuff386.github.io/dashcam-dev/images/step_1.jpg)\r\n\r\nFirst look at the LED one the of wires will be longer and have a smaller plate inside the LED this is the positive/anode. Then clip the metal wires coming out of the LED and resistor.\r\n\r\n![Step 2](http://zachhuff386.github.io/dashcam-dev/images/step_2.jpg)\r\n\r\nSolder the resistor and wires to the LED. It doesn't matter which side of the LED the resistor is on.\r\n\r\n![Step 3](http://zachhuff386.github.io/dashcam-dev/images/step_3.jpg)\r\n\r\nConnect the LED to the pins shown below. The darker wire is the positive/anode.\r\n\r\n![Step 4a](http://zachhuff386.github.io/dashcam-dev/images/step_4a.jpg)\r\n![Step 4b](http://zachhuff386.github.io/dashcam-dev/images/step_4b.jpg)\r\n","google":"UA-20492194-8","note":"Don't delete this file! It's used internally to help with page regeneration."}